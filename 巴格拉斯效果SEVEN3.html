<!DOCTYPE html>
<html lang="zh-TW">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
 <meta name="apple-mobile-web-app-capable" content="yes">
 <meta name="apple-mobile-web-app-status-bar-style" content="default">
 <style>
    :root {
        --paper-bg: #fffcf9;
        --text-color: #2c2c2c;
        --accent: #8b572a;
        --ui-gray: #999;
        --ui-light: #eee;
    }

    /* æ¶ˆé™¤æ‰€æœ‰æ‰‹æ©Ÿç«¯çš„é è¨­é»æ“Šæ•ˆæœ */
    * {
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
        outline: none;
    }

    body { 
        margin: 0; padding: 0; 
        background-color: #ffffff; 
        font-family: "PingFang TC", "Microsoft JhengHei", serif; 
        height: 100vh;
        display: flex;
        justify-content: center;
        overflow: hidden;
    }

    /* APP ä¸»å®¹å™¨ */
    #ebook-app { 
        background-color: var(--paper-bg); 
        width: 100%;
        max-width: 500px;
        height: 100vh;
        position: relative; 
        display: flex;
        flex-direction: column;
        box-shadow: 0 0 30px rgba(0,0,0,0.05);
    }

    /* é ‚éƒ¨ APP åŠŸèƒ½åˆ— */
    #app-header {
        height: 50px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 15px;
        border-bottom: 1px solid rgba(0,0,0,0.05);
        color: var(--ui-gray);
        font-family: sans-serif;
        font-size: 20px;
        background: var(--paper-bg);
        z-index: 10;
    }
    .header-icons span { margin: 0 8px; cursor: pointer; }

    /* åº•éƒ¨ APP é€²åº¦åˆ— */
    #app-footer {
        height: 80px;
        border-top: 1px solid rgba(0,0,0,0.05);
        padding: 10px 20px;
        background: var(--paper-bg);
        z-index: 10;
        display: none; /* è¨ˆç®—å¾Œæ‰é¡¯ç¤º */
    }
    .progress-bar {
        height: 2px;
        background: #ddd;
        width: 100%;
        position: relative;
        margin: 15px 0;
    }
    .progress-dot {
        width: 10px; height: 10px; background: var(--accent);
        border-radius: 50%; position: absolute; top: -4px; left: 65%;
    }
    .footer-info {
        display: flex; justify-content: space-between;
        font-size: 11px; color: #bbb; font-family: sans-serif;
    }

    /* æ•…äº‹å…§æ–‡å€å¡Š */
    #article { 
        flex-grow: 1;
        overflow-y: auto; 
        padding: 30px 25px 30px 35px;
        text-align: justify; 
        line-height: 2.2; 
        font-size: 18.5px; 
        color: var(--text-color); 
        position: relative;
        -webkit-overflow-scrolling: touch;
    }
    #article::-webkit-scrollbar { display: none; }
    #article p { margin-bottom: 25px; text-indent: 2em; font-family: "Noto Serif TC", serif; }

    /* æ›¸è„Šè£è¨‚é™°å½± */
    #article::before {
        content: ""; position: absolute; top: 0; left: 0; width: 15px; height: 100%;
        background: linear-gradient(to right, rgba(0,0,0,0.05) 0%, transparent 100%);
        pointer-events: none;
    }

    /* è¼¸å…¥å€å¡Š (åˆå§‹ä»‹é¢) */
    #inputSection { 
        padding: 20px; text-align: center;
        margin-top: 20px;
    }
    .btn-group { display: flex; justify-content: center; flex-wrap: wrap; margin-bottom: 8px; }
    .small-button { 
        width: 42px; height: 42px; font-size: 18px; margin: 3px; cursor: pointer; 
        border: 1px solid #ddd; border-radius: 8px; background: white; 
    }
    .small-button:active { background: var(--accent); color: white; }
    input { 
        width: 80%; padding: 12px; border: 1px solid #eee; border-radius: 8px; 
        margin: 10px 0; text-align: center; font-size: 18px; background: #fff;
    }
    .calc-btn { 
        background-color: var(--accent); color: #fff; border: none; 
        padding: 14px 40px; border-radius: 30px; cursor: pointer; 
        font-size: 18px; width: 85%; margin-top: 15px; font-weight: bold;
    }

    /* ç¿»é é»æ“Šå€ */
    #prevPageArea, #nextPageArea { 
        position: absolute; top: 50px; bottom: 80px; width: 25%; 
        background: transparent; z-index: 100;
    }
    #prevPageArea { left: 0; }
    #nextPageArea { right: 0; }

    .fade-in { animation: fadeIn 0.4s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
 </style>
</head>
<body>

<div id="ebook-app">
    <div id="app-header">
        <span style="font-size: 24px;">â€¹</span>
        <span style="font-size: 14px; font-weight: bold; letter-spacing: 1px;">å·´æ ¼æ‹‰æ–¯å‚³å¥‡</span>
        <div class="header-icons">
            <span style="font-size: 16px;">á´€A</span>
            <span style="font-size: 18px;">ğŸ”–</span>
        </div>
    </div>

    <div id="inputSection">
      <div class="btn-group">
        <button class="small-button" onclick="chooseCard('é»‘æ¡ƒ')">â™ </button>
        <button class="small-button" onclick="chooseCard('ç´…å¿ƒ')">â™¥</button>
        <button class="small-button" onclick="chooseCard('æ–¹å¡Š')">â™¦</button>
        <button class="small-button" onclick="chooseCard('æ¢…èŠ±')">â™£</button>
      </div>
      <div class="btn-group">
        <button class="small-button" onclick="chooseCard('A')">A</button>
        <button class="small-button" onclick="chooseNumInput('2')">2</button>
        <button class="small-button" onclick="chooseNumInput('3')">3</button>
        <button class="small-button" onclick="chooseNumInput('4')">4</button>
        <button class="small-button" onclick="chooseNumInput('5')">5</button>
        <button class="small-button" onclick="chooseNumInput('6')">6</button>
        <button class="small-button" onclick="chooseNumInput('7')">7</button>
        <button class="small-button" onclick="chooseNumInput('8')">8</button>
        <button class="small-button" onclick="chooseNumInput('9')">9</button>
        <button class="small-button" onclick="chooseNumInput('0')">0</button>
        <button class="small-button" onclick="chooseCard('J')">J</button>
        <button class="small-button" onclick="chooseCard('Q')">Q</button>
        <button class="small-button" onclick="chooseCard('K')">K</button>
      </div>
      <input type="text" id="cardInput" readonly placeholder="SELECT CARD">
      <div class="btn-group">
        <button class="small-button" onclick="chooseNumber('1')">1</button>
        <button class="small-button" onclick="chooseNumber('2')">2</button>
        <button class="small-button" onclick="chooseNumber('3')">3</button>
        <button class="small-button" onclick="chooseNumber('4')">4</button>
        <button class="small-button" onclick="chooseNumber('5')">5</button>
        <button class="small-button" onclick="chooseNumber('6')">6</button>
        <button class="small-button" onclick="chooseNumber('7')">7</button>
        <button class="small-button" onclick="chooseNumber('8')">8</button>
        <button class="small-button" onclick="chooseNumber('9')">9</button>
        <button class="small-button" onclick="chooseNumber('0')">0</button>
      </div>
      <input type="number" id="number" readonly placeholder="SELECT NUMBER">
      <br>
      <button class="calc-btn" onclick="calculate()">é€²å…¥é–±è®€æ¨¡å¼</button>
    </div>

    <div id="article" style="display:none;">
      <div id="articleContent" class="fade-in"></div>
    </div>

    <div id="app-footer">
        <div class="progress-bar"><div class="progress-dot" id="dot"></div></div>
        <div class="footer-info">
            <span id="footer-chapter">Chapter 3</span>
            <span id="footer-page">é é¢è¼‰å…¥ä¸­...</span>
        </div>
    </div>

    <div id="prevPageArea" onclick="prev()" style="display:none"></div>
    <div id="nextPageArea" onclick="next()" style="display:none"></div>
</div>

<script>
    var stack = [
        {suit:"æ¢…èŠ±",number:"4"},{suit:"ç´…å¿ƒ",number:"2"},{suit:"æ–¹å¡Š",number:"7"},{suit:"æ¢…èŠ±",number:"3"},
        {suit:"ç´…å¿ƒ",number:"4"},{suit:"æ–¹å¡Š",number:"6"},{suit:"é»‘æ¡ƒ",number:"A"},{suit:"ç´…å¿ƒ",number:"5"},
        {suit:"é»‘æ¡ƒ",number:"9"},{suit:"é»‘æ¡ƒ",number:"2"},{suit:"ç´…å¿ƒ",number:"Q"},{suit:"æ–¹å¡Š",number:"3"},
        {suit:"æ¢…èŠ±",number:"Q"},{suit:"ç´…å¿ƒ",number:"8"},{suit:"é»‘æ¡ƒ",number:"6"},{suit:"é»‘æ¡ƒ",number:"5"},
        {suit:"ç´…å¿ƒ",number:"9"},{suit:"æ¢…èŠ±",number:"K"},{suit:"æ–¹å¡Š",number:"2"},{suit:"ç´…å¿ƒ",number:"J"},
        {suit:"é»‘æ¡ƒ",number:"3"},{suit:"é»‘æ¡ƒ",number:"8"},{suit:"ç´…å¿ƒ",number:"6"},{suit:"æ¢…èŠ±",number:"10"},
        {suit:"æ–¹å¡Š",number:"5"},{suit:"æ–¹å¡Š",number:"K"},{suit:"æ¢…èŠ±",number:"2"},{suit:"ç´…å¿ƒ",number:"3"},
        {suit:"æ–¹å¡Š",number:"8"},{suit:"æ¢…èŠ±",number:"5"},{suit:"é»‘æ¡ƒ",number:"K"},{suit:"æ–¹å¡Š",number:"J"},
        {suit:"æ¢…èŠ±",number:"8"},{suit:"é»‘æ¡ƒ",number:"10"},{suit:"ç´…å¿ƒ",number:"K"},{suit:"æ¢…èŠ±",number:"J"},
        {suit:"é»‘æ¡ƒ",number:"7"},{suit:"ç´…å¿ƒ",number:"10"},{suit:"æ–¹å¡Š",number:"A"},{suit:"é»‘æ¡ƒ",number:"4"},
        {suit:"ç´…å¿ƒ",number:"7"},{suit:"æ–¹å¡Š",number:"4"},{suit:"æ¢…èŠ±",number:"A"},{suit:"æ¢…èŠ±",number:"9"},
        {suit:"é»‘æ¡ƒ",number:"J"},{suit:"æ–¹å¡Š",number:"Q"},{suit:"æ¢…èŠ±",number:"7"},{suit:"é»‘æ¡ƒ",number:"Q"},
        {suit:"æ–¹å¡Š",number:"10"},{suit:"æ¢…èŠ±",number:"6"},{suit:"ç´…å¿ƒ",number:"A"},{suit:"æ–¹å¡Š",number:"9"}
    ];

    var allDecks = {};
    for (var i = 0; i < 13; i++) {
        var key = String.fromCharCode(65 + i);
        allDecks[key] = stack.slice(i * 4).concat(stack.slice(0, i * 4));
    }

    var resultAction = "";
    var currentPage = 2; 
    var basePg = 37;

    function chooseCard(v) { document.getElementById("cardInput").value += v; }
    function chooseNumInput(v) { document.getElementById("cardInput").value += v; }
    function chooseNumber(v) { document.getElementById("number").value += v; }
    function clearInput() { document.getElementById("cardInput").value = ""; document.getElementById("number").value = ""; }

    function calculate() {
        var cv = document.getElementById("cardInput").value;
        var nv = parseInt(document.getElementById("number").value);
        var parsed = parse(cv);
        if (!parsed || isNaN(nv)) { alert("è«‹æ­£ç¢ºè¨­å®šï¼"); return; }

        let found = false;
        for (let k in allDecks) {
            let deck = allDecks[k];
            let pos = getPos(deck, parsed);
            if (pos + 2 === nv) { setRes(k, "ç¢ºèªåŒ…å«é‚£å…©å¼µå»£å‘Šç‰Œå¾Œ", "èƒŒé¢å‘ä¸‹ä¸€å¼µå¼µå¾€ä¸‹ç™¼", nv); found = true; break; }
            if (pos === nv) { setRes(k, "æ‹¿æ‰é‚£å…©å¼µå»£å‘Šç‰Œå¾Œ", "èƒŒé¢å‘ä¸‹ä¸€å¼µå¼µå¾€ä¸‹ç™¼", nv); found = true; break; }
            if (55 - pos === nv) { setRes(k, "ç¢ºèªåŒ…å«é‚£å…©å¼µé¬¼ç‰Œå¾Œ", "æ­£é¢å‘ä¸Šä¸€å¼µå¼µå¾€ä¸‹ç™¼", nv); found = true; break; }
            if (53 - pos === nv) { setRes(k, "æ‹¿æ‰é‚£å…©å¼µé¬¼ç‰Œå¾Œ", "æ­£é¢å‘ä¸Šä¸€å¼µå¼µå¾€ä¸‹ç™¼", nv); found = true; break; }
        }
        if(!found) { alert("çµ„åˆè¶…å‡ºä½ç§»é™åˆ¶ã€‚"); return; }

        document.getElementById("inputSection").style.display = "none";
        document.getElementById("app-footer").style.display = "block";
        document.getElementById("prevPageArea").style.display = "block";
        document.getElementById("nextPageArea").style.display = "block";
        render();
    }

    function setRes(k, act, dir, n) {
        var locs = {"A":"çª—å°ä¸Š","B":"æ›¸æ«ƒä¸­é–“","C":"é…’æ«ƒè£¡","D":"è¡£æ«ƒè£¡","E":"æ‰‹æåŒ…å…§","F":"å£è¢‹å…§","G":"æ¤…å­åº•ä¸‹","H":"æ¡Œä¸Šçš„ç›’å­å…§","I":"æ‹›è²¡è²“å¾Œé¢","J":"æ¡Œå­ä¸‹é¢çš„æŠ½å±œ","K":"æ¡Œå­å´é‚Šçš„æŠ½å±œ","L":"é›»è¦–æ­£ä¸‹æ–¹çš„æŠ½å±œ","M":"é›»è¦–æ­£ä¸Šæ–¹çš„æ«ƒå­"};
        resultAction = `èµ·èº«èµ°åˆ°${locs[k]}æ‹¿å‡ºä¸€å‰¯æ’²å…‹ç‰Œï¼Œå¤§è¡›è«‹æˆ‘å°‡å…¶å–å‡ºï¼Œ${act}ï¼Œä¸¦è®“æˆ‘å¾${dir}åˆ°ç¬¬ 32 å¼µã€‚`;
        basePg = k.charCodeAt(0) - 64 + 30;
    }

    function getPos(d, t) {
        for(var i=0; i<d.length; i++) if(d[i].suit === t.s && d[i].number === t.n) return i + 1;
        return -1;
    }

    function parse(s) {
        var m = s.match(/^(é»‘æ¡ƒ|ç´…å¿ƒ|æ–¹å¡Š|æ¢…èŠ±)([2-9]|10|A|J|Q|K)$/);
        return m ? { s: m[1], n: m[2] } : null;
    }

    function render() {
        var content = document.getElementById("articleContent");
        var pgFooter = document.getElementById("footer-page");
        var dot = document.getElementById("dot");
        var artDiv = document.getElementById("article");
        
        artDiv.scrollTop = 0;
        content.classList.remove("fade-in");
        void content.offsetWidth; 
        content.classList.add("fade-in");

        if (currentPage === 1) {
            content.innerHTML = `<p>å¤§è¡›Â·å·´æ ¼æ‹‰æ–¯ï¼ˆDavid Berglasï¼‰ï¼Œé‚£æ˜¯é­”è¡“å²ä¸Šæœ€ç¥ç¥•çš„åå­—ä¹‹ä¸€ã€‚</p><p>ä»–æ‰€å‰µé€ çš„ã€Œè–æ®¿ç´š ACAANã€ï¼Œæ›¾è®“ç„¡æ•¸å¤§å¸«ç´šäººç‰©æ„Ÿåˆ°çµ•æœ›ã€‚åœ¨ä»–é¢å‰ï¼Œæ’²å…‹ç‰Œå½·å½¿æ“æœ‰äº†ç”Ÿå‘½ã€‚</p><div style="text-align:center;"><img src="book1.jpg" style="width:95%; border-radius:4px; box-shadow:0 4px 10px rgba(0,0,0,0.1);"></div><p>å¤§è¡›å¸¸èªªï¼ŒACAAN ä¸åªæ˜¯è¨ˆç®—ï¼Œæ›´æ˜¯ä¸€å ´é—œæ–¼å¿ƒéˆèˆ‡éˆé­‚çš„å°è©±ã€‚</p>`;
            pgFooter.innerText = `ç¬¬ ${basePg - 1} é `;
            dot.style.left = "45%";
        } else if (currentPage === 2) {
            content.innerHTML = `
                <p>æ•…äº‹ç™¼ç”Ÿåœ¨ 1976 å¹´ã€‚ç•¶æ™‚æˆ‘å·²èªè­˜å¤§è¡›å¤šå¹´ï¼Œä½†å§‹çµ‚ç„¡ç·£è¦ªçœ¼ç›®ç¹é‚£å€‹å‚³èªªä¸­çš„å¥‡è¹Ÿã€‚ç›´åˆ°æŸæ¬¡ï¼Œå¤§è¡›é‚€è«‹æˆ‘å»ä»–å®¶ä½œå®¢ã€‚</p>
                <p>å¸­é–“ï¼Œå¤§è¡›çªç„¶ç›´è¦–è‘—æˆ‘çš„çœ¼ç›ï¼šã€Œéš¨ä¾¿èªªä¸€å¼µç‰Œï¼Œå’Œä¸€å€‹ 1 åˆ° 52 ä¹‹é–“çš„æ•¸å­—ã€‚ã€</p>
                <p>æˆ‘ä¸å‡æ€ç´¢åœ°å›ç­”ï¼šã€Œæ–¹å¡Š 5ï¼Œ32ã€ã€‚</p>
                <p>å¤§è¡›ç·©ç·©èµ·èº«ï¼Œ${resultAction} æ•¸åˆ°æœ€å¾Œé‚£ä¸€å¼µç‰Œæ™‚ï¼Œç©ºæ°£å½·å½¿å‡å›ºäº†...</p>
                <p>å¤§è¡›è¼•è²èªªï¼šã€Œç¿»é–‹å®ƒã€‚ã€</p>
                <p>ä½ çŸ¥é“çš„ï¼Œé‚£å¼µç‰Œæ­£æ˜¯ã€Œæ–¹å¡Š 5ã€ï¼ï¼ï¼æˆ‘æ°¸é å¿˜ä¸äº†é‚£å¤©ã€‚é€™å°±æ˜¯å‚³èªªä¸­çš„ã€Œå·´æ ¼æ‹‰æ–¯æ•ˆæœã€ã€‚</p>
            `;
            pgFooter.innerText = `ç¬¬ ${basePg} é `;
            dot.style.left = "65%";
        } else if (currentPage === 3) {
            content.innerHTML = `<p style="margin-top:150px; text-align:center; font-style:italic; color: #888;">ã€Œæˆ‘æ°¸é å¿˜ä¸äº†é‚£å€‹ç”·äºº......æ°¸é ã€‚ã€</p>`;
            pgFooter.innerText = `ç¬¬ ${basePg + 1} é `;
            dot.style.left = "85%";
        }
        artDiv.style.display = "block";
    }

    function next() { if(currentPage < 3) { currentPage++; render(); } }
    function prev() { if(currentPage > 1) { currentPage--; render(); } }

    document.addEventListener("contextmenu", e => e.preventDefault());
    document.addEventListener("keydown", e => { if (e.keyCode == 123 || (e.ctrlKey && e.key.toLowerCase() === 'u')) e.preventDefault(); });
</script>
</body>
</html>
