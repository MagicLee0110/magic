<!DOCTYPE html>
<html lang="zh-TW">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
 <meta name="apple-mobile-web-app-capable" content="yes">
 <meta name="apple-mobile-web-app-status-bar-style" content="default">
 <title>é›»å­æ¨¹APP</title>
 <link rel="apple-touch-icon" href="Tree.png">
 <link rel="icon" href="Tree.png" type="image/png">
 <style>
    :root {
        --paper-bg: #fffdfb; --text-color: #787878; --header-text: #bbbbbb; --accent-brown: #8b572a; --shelf-bg: #ffffff; --ui-blue: #007aff; --ui-gray: #f2f2f7;
    }
    * { -webkit-tap-highlight-color: transparent !important; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; outline: none; box-sizing: border-box; }
    html, body { margin: 0; padding: 0; height: 100%; width: 100%; background-color: #fff; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; overflow: hidden; }

    /* --- ä¸»è¦åˆ†é å®¹å™¨ --- */
    .view-container { width: 100%; max-width: 500px; height: calc(100dvh - 65px); margin: 0 auto; display: none; flex-direction: column; overflow-y: auto; background: var(--shelf-bg); }
    .active-view { display: flex; }

    /* --- 1. æ›¸æ«ƒè¦–åœ– --- */
    .lib-header { height: 70px; display: flex; align-items: flex-end; padding: 0 20px 15px; font-size: 26px; font-weight: 800; border-bottom: 1px solid #f2f2f2; background: #fff; }
    .lib-content { padding: 20px; }
    .book-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px 20px; }
    .book-card { display: flex; flex-direction: column; cursor: pointer; }
    .book-cover { width: 100%; aspect-ratio: 2/3; border-radius: 6px; box-shadow: 0 6px 15px rgba(0,0,0,0.12); position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; text-align: center; padding: 12px; font-size: 14px; font-weight: bold; color: white; transition: transform 0.2s; }
    .book-cover::after { content: ''; position: absolute; top:0; left:0; width: 6%; height:100%; background: linear-gradient(to right, rgba(255,255,255,0.3), rgba(0,0,0,0.05)); }
    .book-info { margin-top: 10px; font-size: 13px; color: #333; height: 36px; overflow: hidden; font-weight: 600; line-height: 1.3; }
    .book-progress { font-size: 11px; color: #999; margin-top: 4px; display: flex; align-items: center; gap: 4px; }

    /* --- 2. å•†åº—è¦–åœ– --- */
    .shop-header { padding: 20px; font-size: 24px; font-weight: 800; }
    .shop-section { padding: 0 20px 20px; }
    .shop-banner { width: 100%; height: 150px; background: linear-gradient(135deg, #6e8efb, #a777e3); border-radius: 12px; margin-bottom: 20px; display: flex; align-items: center; padding: 20px; color: white; position: relative; overflow: hidden; }
    .shop-item { display: flex; gap: 15px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #f2f2f2; }
    .shop-thumb { width: 60px; height: 90px; background: #eee; border-radius: 4px; flex-shrink: 0; }
    .shop-price { color: var(--ui-blue); font-weight: bold; margin-top: 5px; }

    /* --- 3. è¨­å®šè¦–åœ– --- */
    .settings-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: white; border-bottom: 1px solid #f2f2f2; font-size: 16px; color: #333; }
    .settings-group { margin-top: 25px; border-top: 1px solid #f2f2f2; }

    /* --- åº•éƒ¨å°è¦½æ¬„ --- */
    .nav-bar { width: 100%; max-width: 500px; height: 65px; margin: 0 auto; border-top: 1px solid #eee; display: flex; justify-content: space-around; align-items: center; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); position: fixed; bottom: 0; left: 0; right: 0; z-index: 1000; padding-bottom: env(safe-area-inset-bottom, 0); }
    .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 10px; color: #999; width: 33%; cursor: pointer; }
    .nav-item.active { color: var(--ui-blue); }
    .nav-icon { font-size: 22px; }

    /* --- è©³æƒ…é ã€è¨­å®šé ã€é–±è®€å™¨ (æ‚¨çš„ç¶“å…¸è¨­è¨ˆ) --- */
    #info-view, #magic-setup, #ebook-app { display: none; background: white; width: 100%; max-width: 500px; height: 100dvh; position: fixed; top: 0; left: 50%; transform: translateX(-50%); z-index: 2000; overflow-y: auto; padding: 40px 25px; flex-direction: column; align-items: center; }
    .read-btn { width: 100%; background: var(--ui-blue); color: white; padding: 16px; border-radius: 10px; font-weight: bold; margin-top: auto; text-align: center; }
    
    /* æ ¸å¿ƒè¼¸å…¥æŒ‰éˆ•æ¨£å¼ (æ¢å¾© 44px ç¶“å…¸) */
    .btn-group { display: flex; justify-content: center; flex-wrap: wrap; margin-bottom: 8px; }
    .small-button { width: 44px; height: 44px; font-size: 18px; margin: 3px; cursor: pointer; border: 1px solid #ddd; border-radius: 10px; background: white; color: #333; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .small-button:active { background: #eee; transform: scale(0.95); }
    input { width: 85%; padding: 12px; border: 1px solid #eee; border-radius: 8px; margin: 15px 0; text-align: center; font-size: 18px; color: var(--accent-brown); font-weight: bold; background: #fafafa; }
    .calc-btn { background: var(--accent-brown); color: white; border: none; padding: 16px; border-radius: 30px; font-size: 18px; font-weight: bold; margin-top: 15px; width: 85%; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .reset-btn { background: none; border: 1px solid #ddd; color: #999; padding: 10px; border-radius: 20px; width: 60%; margin-top: 20px; font-size: 13px; }

    /* é–±è®€å™¨æ¨£å¼ */
    #ebook-app { background-color: var(--paper-bg); padding: 0; }
    #app-header { flex-shrink: 0; height: calc(55px + env(safe-area-inset-top, 0)); display: flex; justify-content: space-between; align-items: center; padding: env(safe-area-inset-top, 0) 15px 0; border-bottom: 1px solid rgba(0,0,0,0.04); background: var(--paper-bg); width: 100%; }
    #article { flex: 1; overflow-y: auto; padding: 30px 25px 60px 35px; text-align: justify; line-height: 2.3; font-size: 18px; color: var(--text-color); }
    #article p { margin-bottom: 35px; text-indent: 2em; font-family: "Noto Serif TC", serif; letter-spacing: 0.8px; }
    #app-footer { flex-shrink: 0; background: var(--paper-bg); border-top: 1px solid rgba(0,0,0,0.04); padding: 15px 30px calc(25px + env(safe-area-inset-bottom, 10px)) 30px; width: 100%; }
    .progress-dot { width: 7px; height: 7px; background: var(--accent-brown); border-radius: 50%; position: absolute; top: -2.5px; transition: left 0.4s ease; }
    #prevArea, #nextArea { position: absolute; top: 80px; bottom: 80px; width: 35%; z-index: 3000; }
    #prevArea { left: 0; } #nextArea { right: 0; }
    .fade-page { animation: fadeIn 0.5s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    .drop-cap::first-letter { float: left; font-size: 52px; line-height: 0.8; padding: 6px 8px 0 0; color: var(--accent-brown); font-family: serif; }
    .master-note { background: rgba(139,87,42,0.02); border-left: 2px solid var(--accent-brown); padding: 15px; margin: 30px 0; font-size: 16px; font-style: italic; color: #999; }
    .book-img { text-align: center; margin: 25px 0; border: 1px solid rgba(0,0,0,0.03); padding: 8px; }
    .book-img img { max-width: 100%; filter: sepia(12%) contrast(95%); opacity: 0.85; }
 </style>
</head>
<body>

<div id="library-view" class="view-container active-view">
    <div class="lib-header">æˆ‘çš„æ›¸æ«ƒ</div>
    <div class="lib-content"><div class="book-grid" id="mainGrid"></div></div>
</div>

<div id="shop-view" class="view-container">
    <div class="shop-header">æ›¸åº—ç²¾é¸</div>
    <div class="shop-section">
        <div class="shop-banner">
            <div><div style="font-size:12px;opacity:0.8">æœ¬é€±å¼·æ‰“</div><div style="font-size:20px;font-weight:bold">è§£æ§‹å¤§è…¦çš„é åˆ¤æ©Ÿåˆ¶</div></div>
        </div>
        <div class="shop-item"><div class="shop-thumb" style="background:#4a5a6a"></div><div><div style="font-weight:bold">è¡Œç‚ºå¿ƒç†å­¸ï¼šå¯¦æˆ°ç¯‡</div><div style="font-size:12px;color:#999">ä½œè€…ï¼šMark Z.</div><div class="shop-price">$380</div></div></div>
        <div class="shop-item"><div class="shop-thumb" style="background:#6a4a4a"></div><div><div style="font-weight:bold">å¾®å‹•ä½œè®€å¿ƒè¡“</div><div style="font-size:12px;color:#999">ä½œè€…ï¼šFBI é¡§å•</div><div class="shop-price">$450</div></div></div>
    </div>
</div>

<div id="settings-view" class="view-container">
    <div style="padding:40px 20px 20px; font-size:24px; font-weight:800">è¨­å®š</div>
    <div class="settings-item"><span>å€‹äººå¸³æˆ¶</span><span style="color:#999">æ£®æ£®å¤§å¸« â€º</span></div>
    <div class="settings-group">
        <div class="settings-item"><span>é›²ç«¯åŒæ­¥</span><span style="color:var(--ui-blue)">å·²é–‹å•Ÿ</span></div>
        <div class="settings-item"><span>é–±è®€èƒŒæ™¯è‰²</span><span style="color:#999">ç±³ç™½è‰² â€º</span></div>
        <div class="settings-item"><span>å­—é«”å¤§å°</span><span style="color:#999">18px â€º</span></div>
    </div>
    <div class="settings-group">
        <div class="settings-item" onclick="fullReset()"><span>æ¸…é™¤å¿«å–è¨˜æ†¶ (é‡ç½®)</span><span style="color:red">ç«‹å³åŸ·è¡Œ</span></div>
    </div>
</div>

<div class="nav-bar">
    <div class="nav-item active" onclick="switchTab('library')"><span class="nav-icon">ğŸ“š</span><span>æ›¸æ«ƒ</span></div>
    <div class="nav-item" onclick="switchTab('shop')"><span class="nav-icon">ğŸ›’</span><span>å•†åº—</span></div>
    <div class="nav-item" onclick="switchTab('settings')"><span class="nav-icon">âš™ï¸</span><span>è¨­å®š</span></div>
</div>

<div id="info-view">
    <div style="align-self:flex-start; color:var(--ui-blue); font-size: 17px; padding: 10px 0;" onclick="closeInfo()">â€¹ æ›¸æ«ƒ</div>
    <div id="info-cover-target" class="info-cover-box" style="width:160px;height:240px;border-radius:4px;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;text-align:center;padding:15px;box-shadow:0 10px 30px rgba(0,0,0,0.3)"></div>
    <h2 id="info-title" style="margin-top:25px; font-size:22px;"></h2>
    <p id="info-author" style="color:#888; font-size:14px; margin-top:5px;"></p>
    <p id="info-desc" style="color:#666; font-size:14px; margin-top:20px; text-align:justify; line-height:1.6; border-top:1px solid #eee; padding-top:20px;"></p>
    <div class="read-btn" onclick="checkMagicFlow()">ç¹¼çºŒé–±è®€</div>
</div>

<div id="magic-setup">
    <div style="align-self:flex-start; color:var(--ui-blue); font-size: 17px; padding: 10px 0;" onclick="closeSetup()">â€¹ è¿”å›è©³æƒ…</div>
    <h3 style="margin-top:30px">èº«ä»½æ¬Šé™é©—è­‰</h3>
    <div class="btn-group" style="margin-top: 20px;"><button class="small-button" onclick="chooseCard('é»‘æ¡ƒ')">â™ </button><button class="small-button" onclick="chooseCard('ç´…å¿ƒ')">â™¥</button><button class="small-button" onclick="chooseCard('æ–¹å¡Š')">â™¦</button><button class="small-button" onclick="chooseCard('æ¢…èŠ±')">â™£</button></div>
    <div class="btn-group"><button class="small-button" onclick="chooseCard('A')">A</button><button class="small-button" onclick="chooseNumInput('2')">2</button><button class="small-button" onclick="chooseNumInput('3')">3</button><button class="small-button" onclick="chooseNumInput('4')">4</button><button class="small-button" onclick="chooseNumInput('5')">5</button><button class="small-button" onclick="chooseNumInput('6')">6</button><button class="small-button" onclick="chooseNumInput('7')">7</button><button class="small-button" onclick="chooseNumInput('8')">8</button><button class="small-button" onclick="chooseNumInput('9')">9</button><button class="small-button" onclick="chooseNumInput('10')">10</button><button class="small-button" onclick="chooseCard('J')">J</button><button class="small-button" onclick="chooseCard('Q')">Q</button><button class="small-button" onclick="chooseCard('K')">K</button></div>
    <input type="text" id="cardInput" readonly placeholder="è«‹é»é¸æ’²å…‹ç‰Œ">
    <div class="btn-group"><button class="small-button" onclick="chooseNumber('1')">1</button><button class="small-button" onclick="chooseNumber('2')">2</button><button class="small-button" onclick="chooseNumber('3')">3</button><button class="small-button" onclick="chooseNumber('4')">4</button><button class="small-button" onclick="chooseNumber('5')">5</button><button class="small-button" onclick="chooseNumber('6')">6</button><button class="small-button" onclick="chooseNumber('7')">7</button><button class="small-button" onclick="chooseNumber('8')">8</button><button class="small-button" onclick="chooseNumber('9')">9</button><button class="small-button" onclick="chooseNumber('0')">0</button></div>
    <input type="number" id="number" readonly placeholder="è«‹é»é¸æ•¸å­—">
    <button class="calc-btn" onclick="calculate()">é©—è­‰æ¬Šé™ä¸¦é–±è®€</button>
    <button class="reset-btn" onclick="clearInputs()">é‡æ–°è¼¸å…¥</button>
</div>

<div id="ebook-app">
    <div id="app-header">
        <span onclick="exitReader()" style="font-size:32px; color:var(--ui-blue); font-weight:300; padding: 0 10px;">â€¹</span>
        <span id="reader-book-title" style="font-size:12px; font-weight:bold; color:#aaa; letter-spacing:1px;"></span>
        <span style="font-size:18px; color:var(--ui-blue);">á´€A</span>
    </div>
    <div id="article"><div id="articleContent" class="fade-page"></div></div>
    <div id="app-footer">
        <div class="progress-container" style="width:100%; height:2px; background:#f2f2f2; position:relative; margin-bottom:12px;"><div class="progress-dot" id="dot"></div></div>
        <div class="footer-info">ç¬¬ <span id="cur-p"></span> é  / å…± 100 é </div>
    </div>
    <div id="prevArea" onclick="prev()"></div><div id="nextArea" onclick="next()"></div>
</div>

<script>
    const bookData = [
        { id: 1, t: "æ€è€ƒï¼Œå¿«èˆ‡æ…¢", a: "Daniel Kahneman", d: "é—œæ–¼äººé¡èªçŸ¥åå·®çš„æ¬Šå¨è‘—ä½œã€‚", p: "æœªè®€", bg: "linear-gradient(135deg, #2c3e50, #000)" },
        { id: 2, t: "å½±éŸ¿åŠ›å¿ƒç†å­¸", a: "Robert Cialdini", d: "æ­é–‹èªªæœèˆ‡æœå¾çš„ç¤¾æœƒå¿ƒç†æ³•å‰‡ã€‚", p: "æœªä¸‹è¼‰", bg: "linear-gradient(45deg, #ff5858, #f09819)" },
        { id: 3, t: "THE MAGIC SENTINEL", a: "David Berglas", d: "æœ¬ç« è©³ç´°è¨˜éŒ„äº†å¤§è¡›Â·å·´æ ¼æ‹‰æ–¯çš„å³èˆˆå¥‡è¹Ÿå¯¦éŒ„ã€‚æ·±å…¥æ¢è¨ ACAAN çš„æœ€çµ‚å¿ƒç†æ¶æ§‹ã€‚", p: "36% å·²è®€", isM: true, bg: "linear-gradient(to bottom, #3d2b1f, #1a110a)", color: "#e5c100", b: "2px solid #cfa670" },
        { id: 4, t: "FBI è®€å¿ƒè¡“", a: "Joe Navarro", d: "å‰æƒ…å ±å“¡è¦ªæˆç ´è§£èº«é«”èªè¨€çš„æŠ€è¡“ã€‚", p: "å·²å®Œè®€", bg: "linear-gradient(to right, #434343, #000)" },
        { id: 5, t: "æš—ç¤ºçš„è—è¡“", a: "Mentalist Guide", d: "å¦‚ä½•åˆ©ç”¨èªè¨€åœ¨æ½›æ„è­˜ä¸­æ¤å…¥æƒ³æ³•ã€‚", p: "æœªè®€", bg: "repeating-linear-gradient(45deg, #1a1a1a, #1a1a1a 10px, #222 10px, #222 20px)" },
        { id: 6, t: "å†·è®€è¡“å¯¦å‹™", a: "Ian Rowland", d: "å¿ƒéˆé­”è¡“æœ€å®Œæ•´çš„èªè¨€æ¶æ§‹æ‰‹å†Šã€‚", p: "æœªä¸‹è¼‰", bg: "linear-gradient(to top, #cfd9df, #e2ebf0)", black: true },
        { id: 7, t: "æ©Ÿç‡çš„é™·é˜±", a: "å­¸è¡“ç ”ç©¶çµ„", d: "æ­é–‹éš¨æ©Ÿæ€§èƒŒå¾Œçš„è¦å¾‹èˆ‡æ•¸å­¸è¬¬èª¤ã€‚", p: "æœªè®€", bg: "linear-gradient(135deg, #09203f, #537895)" },
        { id: 8, t: "å¤§è…¦é­”è¡“å¸«", a: "Psychology Press", d: "è¦–è¦ºèˆ‡è½è¦ºç”¢ç”Ÿçš„çŸ¥è¦ºåå·®å¯¦é©—è¨˜éŒ„ã€‚", p: "æœªä¸‹è¼‰", bg: "linear-gradient(to top, #1e3c72, #2a5298)" },
        { id: 9, t: "è¡Œç‚ºç¶“æ¿Ÿå­¸", a: "ç¤¾æœƒç§‘å­¸é™¢", d: "äººé¡éç†æ€§æ±ºç­–çš„æ·±å±¤åŸå› åˆ†æã€‚", p: "æœªè®€", bg: "linear-gradient(to top, #c79081, #dfa579)" },
        { id: 10, t: "æœ€å¾Œçš„è–æ¯", a: "å…§éƒ¨å­˜æª”", d: "é›†çµæ‰€æœ‰é«˜ç«¯ä½ç§»æŠ€è¡“çš„ç¸½çµå ±å‘Šã€‚", p: "æœªè®€", bg: "linear-gradient(45deg, #874da2, #c43a30)" }
    ];

    var stack = [{suit:"æ¢…èŠ±",number:"4"},{suit:"ç´…å¿ƒ",number:"2"},{suit:"æ–¹å¡Š",number:"7"},{suit:"æ¢…èŠ±",number:"3"},{suit:"ç´…å¿ƒ",number:"4"},{suit:"æ–¹å¡Š",number:"6"},{suit:"é»‘æ¡ƒ",number:"A"},{suit:"ç´…å¿ƒ",number:"5"},{suit:"é»‘æ¡ƒ",number:"9"},{suit:"é»‘æ¡ƒ",number:"2"},{suit:"ç´…å¿ƒ",number:"Q"},{suit:"æ–¹å¡Š",number:"3"},{suit:"æ¢…èŠ±",number:"Q"},{suit:"ç´…å¿ƒ",number:"8"},{suit:"é»‘æ¡ƒ",number:"6"},{suit:"é»‘æ¡ƒ",number:"5"},{suit:"ç´…å¿ƒ",number:"9"},{suit:"æ¢…èŠ±",number:"K"},{suit:"æ–¹å¡Š",number:"2"},{suit:"ç´…å¿ƒ",number:"J"},{suit:"é»‘æ¡ƒ",number:"3"},{suit:"é»‘æ¡ƒ",number:"8"},{suit:"ç´…å¿ƒ",number:"6"},{suit:"æ¢…èŠ±",number:"10"},{suit:"æ–¹å¡Š",number:"5"},{suit:"æ–¹å¡Š",number:"K"},{suit:"æ¢…èŠ±",number:"2"},{suit:"ç´…å¿ƒ",number:"3"},{suit:"æ–¹å¡Š",number:"8"},{suit:"æ¢…èŠ±",number:"5"},{suit:"é»‘æ¡ƒ",number:"K"},{suit:"æ–¹å¡Š",number:"J"},{suit:"æ¢…èŠ±",number:"8"},{suit:"é»‘æ¡ƒ",number:"10"},{suit:"ç´…å¿ƒ",number:"K"},{suit:"æ¢…èŠ±",number:"J"},{suit:"é»‘æ¡ƒ",number:"7"},{suit:"ç´…å¿ƒ",number:"10"},{suit:"æ–¹å¡Š",number:"A"},{suit:"é»‘æ¡ƒ",number:"4"},{suit:"ç´…å¿ƒ",number:"7"},{suit:"æ–¹å¡Š",number:"4"},{suit:"æ¢…èŠ±",number:"A"},{suit:"æ¢…èŠ±",number:"9"},{suit:"é»‘æ¡ƒ",number:"J"},{suit:"æ–¹å¡Š",number:"Q"},{suit:"æ¢…èŠ±",number:"7"},{suit:"é»‘æ¡ƒ",number:"Q"},{suit:"æ–¹å¡Š",number:"10"},{suit:"æ¢…èŠ±",number:"6"},{suit:"ç´…å¿ƒ",number:"A"},{suit:"æ–¹å¡Š",number:"9"}];
    var allDecks = {}; for (var i = 0; i < 13; i++) { allDecks[String.fromCharCode(65 + i)] = stack.slice(i * 4).concat(stack.slice(0, i * 4)); }
    var resultAction = "", currentPage = 37, isCalculated = false, currentActiveBook = null;

    function initShelf() {
        const grid = document.getElementById("mainGrid");
        bookData.forEach(b => {
            const card = document.createElement("div");
            card.className = "book-card";
            card.onclick = () => showInfo(b);
            card.innerHTML = `<div class="book-cover" style="background:${b.bg}; border:${b.b||'none'}; color:${b.color||(b.black?'#333':'#fff')}">${b.t}</div><div class="book-info">${b.t}</div><div class="book-progress" ${b.isM?'id="magic-prog"':''}>${b.isM?'ğŸ“– ':'â˜ï¸ '}${b.p}</div>`;
            grid.appendChild(card);
        });
    }
    initShelf();

    function switchTab(tab) {
        document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active-view'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.getElementById(tab + '-view').classList.add('active-view');
        event.currentTarget.classList.add('active');
    }

    function showInfo(b) {
        currentActiveBook = b; document.getElementById("info-title").innerText = b.t; document.getElementById("info-author").innerText = b.a; document.getElementById("info-desc").innerText = b.d;
        const target = document.getElementById("info-cover-target");
        target.style.background = b.bg; target.style.color = b.color || (b.black?'#333':'#fff'); target.innerText = b.t;
        document.getElementById("info-view").style.display = "flex";
    }
    function closeInfo() { document.getElementById("info-view").style.display = "none"; }
    function openSetup() { document.getElementById("info-view").style.display = "none"; document.getElementById("magic-setup").style.display = "flex"; }
    function closeSetup() { document.getElementById("magic-setup").style.display = "none"; document.getElementById("info-view").style.display = "flex"; }
    function checkMagicFlow() { if(currentActiveBook.isM && isCalculated) { document.getElementById("info-view").style.display="none"; openReader(); } else { openSetup(); } }
    function openReader() { document.getElementById("reader-book-title").innerText = currentActiveBook.t; document.getElementById("ebook-app").style.display = "flex"; render(); }
    function exitReader() { document.getElementById("ebook-app").style.display = "none"; document.getElementById("magic-prog").innerText = "ğŸ“– " + currentPage + "% å·²è®€"; }
    function fullReset() { isCalculated = false; currentPage = 37; clearInputs(); alert("æ›¸æ«ƒè³‡æ–™å·²åŒæ­¥æ›´æ–°"); }
    function chooseCard(v) { document.getElementById("cardInput").value += v; }
    function chooseNumInput(v) { document.getElementById("cardInput").value += v; }
    function chooseNumber(v) { document.getElementById("number").value += v; }
    function clearInputs() { document.getElementById("cardInput").value = ""; document.getElementById("number").value = ""; }

    function calculate() {
        var cv = document.getElementById("cardInput").value, nv = parseInt(document.getElementById("number").value), parsed = parse(cv);
        if (!parsed || isNaN(nv)) { alert("é©—è­‰ç¢¼éŒ¯èª¤"); return; }
        let found = false;
        for (let k in allDecks) {
            let deck = allDecks[k], pos = getPos(deck, parsed);
            if (pos + 2 === nv) { setRes(k, "èƒŒé¢å‘ä¸Šä¸€å¼µå¼µå¾€ä¸‹ç™¼"); found = true; break; }
            if (pos === nv) { setRes(k, "æ‹¿æ‰å»£å‘Šç‰Œå¾Œï¼ŒèƒŒé¢å‘ä¸Šä¸€å¼µå¼µå¾€ä¸‹ç™¼"); found = true; break; }
            if (55 - pos === nv) { setRes(k, "ç‰Œé¢å‘ä¸Šä¸€å¼µä¸€å¼µå¾€ä¸‹ç™¼ï¼Œä½¿æˆ‘å¯ä»¥æ¸…æ¥šçš„çœ‹è¦‹æ¯ä¸€å¼µæ’²å…‹ç‰Œçš„ç‰Œé¢"); found = true; break; }
            if (53 - pos === nv) { setRes(k, "æ‹¿æ‰é¬¼ç‰Œå¾Œï¼Œç‰Œé¢å‘ä¸Šä¸€å¼µä¸€å¼µå¾€ä¸‹ç™¼ï¼ŒåŒæ™‚æˆ‘å¯ä»¥æ¸…æ¥šçš„çœ‹è¦‹æ¯ä¸€å¼µæ’²å…‹ç‰Œçš„ç‰Œé¢"); found = true; break; }
        }
        if(!found) { alert("åºè™Ÿç„¡æ•ˆ"); return; }
        isCalculated = true; document.getElementById("magic-setup").style.display = "none"; openReader();
    }
    function setRes(k, act) { resultAction = `å¾${{"A":"çª—å°ä¸Š","B":"æ›¸æ«ƒä¸­é–“","C":"é…’æ«ƒè£¡","D":"è¡£æ«ƒè£¡","E":"æ‰‹æåŒ…å…§","F":"å£è¢‹å…§","G":"æ¤…å­åº•ä¸‹","H":"æ¡Œä¸Šçš„ç›’å­å…§","I":"æ‹›è²¡è²“å¾Œé¢","J":"æ¡Œå­ä¸‹é¢çš„æŠ½å±œ","K":"æ¡Œå­å´é‚Šçš„æŠ½å±œ","L":"é›»è¦–æ­£ä¸‹æ–¹çš„æŠ½å±œ","M":"é›»è¦–æ­£ä¸Šæ–¹çš„æ«ƒå­"}[k]}æ‹¿å‡ºä¸€å‰¯æ’²å…‹ç‰Œï¼Œå¤§è¡›è«‹æˆ‘å°‡ç‰Œå–å‡ºï¼Œ${act}ï¼Œ`; }
    function getPos(d, t) { for(var i=0; i<d.length; i++) if(d[i].suit === t.s && d[i].number === t.number) return i + 1; return -1; }
    function parse(s) { var m = s.match(/^(é»‘æ¡ƒ|ç´…å¿ƒ|æ–¹å¡Š|æ¢…èŠ±)([2-9]|10|A|J|Q|K)$/); return m ? { s: m[1], number: m[2] } : null; }

    function getDynamicContent(p) {
        if (p === 34) return `<h2 style="text-align:center; margin-top:60px; font-weight:300; letter-spacing:5px;">SECTION III</h2><h1 style="text-align:center; font-size:26px; color:var(--accent-brown); letter-spacing:2px;">å·´æ ¼æ‹‰æ–¯æ•ˆæœ</h1><p class="drop-cap" style="margin-top:40px;">æ¯«ç„¡ç–‘å•ï¼Œé€™å€‹æ•ˆæœå·²ç¶“åˆ°é”äº†ã€Œå‚³å¥‡ã€çš„åœ°ä½ã€‚é€™æ˜¯ä¸€å€‹å¦‚æ­¤ä¸å¯èƒ½çš„æ•ˆæœï¼Œä»¥è‡³æ–¼é­”è¡“åœˆå…§æœ€è°æ˜çš„äººéƒ½åœ¨çµç›¡è…¦æ±åœ°å°‹æ‰¾è§£æ±ºè¾¦æ³•ï¼Œç”šè‡³æœ‰äº›äººæ ¹æœ¬ä¸ç›¸ä¿¡é€™å€‹æ•ˆæœçš„å­˜åœ¨ï¼Œæœ¬ç« æˆ‘å°‡å¸¶èˆ‡ä½ ä¸€åŒåˆ†äº«ï¼Œé€™å€‹å‚³å¥‡çš„æ•…äº‹ã€‚</p>`;
        if (p === 35) return `<p>å¿ƒéˆé­”è¡“çš„è–æ¯â€”â€”ACAANè‡³ä»Šå·²æ“æœ‰å¤šå¹´çš„æ­·å²ï¼Œéš¨ä¾¿ä¸€å¼µç‰Œä»»æ„ä¸€å€‹æ•¸å­—çš„å·§åˆï¼Œä¸–ç•Œå„åœ°çš„é­”è¡“å¸«éƒ½æ“æœ‰å±¬æ–¼è‡ªå·±çš„ACAANç‰ˆæœ¬ã€‚æœ€å…·ä»£è¡¨æ€§çš„è«éæ–¼å¤§è¡›Â·å·´æ ¼æ‹‰æ–¯ï¼ˆDavid Berglasï¼‰ã€‚</p><div class="book-img"><img src="book1.jpg" alt="Photo"></div><p>è‡³ä»Šä¾ç„¶æ²’æœ‰ä¸€å€‹é­”è¡“å¸«èƒ½å®Œå…¨è§£é‡‹å¤§è¡›æ˜¯å¦‚ä½•é‹ä½œé€™å€‹æ•ˆæœçš„ã€‚å¤§è¡›ç¸½æ˜¯æ‹’çµ•è§£é‡‹ç§˜å¯†ï¼Œæ˜¯ç‚ºäº†ç•™ä¸‹è§€çœ¾å¿ƒä¸­çš„å¥‡è¹Ÿã€‚</p>`;
        if (p === 36) return `<p>åœ¨é‚£å€«æ•¦çš„åˆå¾Œï¼Œå£çˆæ—çš„å°è©±ä¾ç„¶æ¸…æ™°ã€‚å¤§è¡›çªç„¶çœ‹è‘—æˆ‘çš„çœ¼ç›èªªï¼šã€Œéš¨ä¾¿èªªä¸€å¼µç‰Œï¼Œå’Œä¸€å€‹ 1 åˆ° 52 ä¹‹é–“çš„æ•¸å­—ã€‚ã€</p><p>æˆ‘ä¸å‡æ€ç´¢åœ°å›ç­”ï¼šã€Œæ–¹å¡Š 5ï¼Œ32ã€ã€‚å¤§è¡›è½å®Œå¾Œï¼Œéœ²å‡ºäº†é‚£å€‹æ¨™èªŒæ€§çš„ç¥ç¥•å¾®ç¬‘ã€‚</p>`;
        if (p === 37) return `<p class="drop-cap">æ•…äº‹ç™¼ç”Ÿåœ¨ 1976 å¹´ã€‚ç•¶æ™‚æˆ‘å·²èªè­˜å¤§è¡›å¤šå¹´ï¼Œå§‹çµ‚æœªèƒ½è¦ªçœ¼ç›®ç¹å‚³èä¸­çš„å¥‡è¹Ÿã€‚ç›´åˆ°é‚£æ¬¡ï¼Œå¤§è¡›é‚€è«‹æˆ‘å»ä»–å®¶ä½œå®¢ã€‚è¨˜å¾—ç•¶æ™‚èŠçš„æ­£æ„‰å¿«æ™‚ï¼Œå¤§è¡›çªç„¶å•æˆ‘ï¼šã€Œéš¨ä¾¿èªªä¸€å¼µç‰Œï¼Œå’Œä¸€å€‹ 1 åˆ° 52 ä¹‹é–“çš„æ•¸å­—ã€‚ã€</p><p>æˆ‘ä¸å‡æ€ç´¢åœ°å›ç­”ï¼šã€Œæ–¹å¡Š 5ï¼Œ32ã€ã€‚</p><p>å¤§è¡›å…ˆåˆ†äº«äº†ä¸€å€‹æœ‰è¶£çš„å°æ•…äº‹å¾Œï¼Œä¾¿ç·©ç·©èµ·èº«ï¼Œ${resultAction} ç•¶æ•¸åˆ°ç¬¬ 32 å¼µæ™‚ï¼Œç©ºæ°£ä»¿ä½›å‡å›ºäº†...</p><p>ä½ çŸ¥é“çš„...é‚£å¼µç‰Œæ­£æ˜¯ã€Œæ–¹å¡Š 5ã€ï¼æˆ‘æ°¸é å¿˜ä¸äº†é‚£å¤©...é€™å°±æ˜¯å‚³èªªä¸­çš„ã€Œå·´æ ¼æ‹‰æ–¯æ•ˆæœã€ï¼Œå¤šå¸Œæœ›ä½ å€‘ä¹Ÿèƒ½å¤ åœ¨å ´è¦‹è­‰ã€‚</p>`;
        if (p === 38) return `<p style="margin-top:180px; text-align:center; font-style:italic; font-size: 20px;">ã€Œæˆ‘æ°¸é å¿˜ä¸äº†é‚£å€‹ç”·äºº......æ°¸é ã€‚ã€</p><div class="master-note" style="text-align:center;">è‡³æ­¤å¾Œï¼Œæˆ‘ä¸æ–·åœ°åœ¨å°‹æ‰¾ä»»ä½•å¯èƒ½çš„ç­”æ¡ˆ...ä½†ä¸€åˆ‡éƒ½å¤ªä¸å¯èƒ½äº†ï¼Œç›´åˆ°ç¾åœ¨ï¼Œæˆ‘é‚„æ˜¯ä¸€é»æƒ³æ³•éƒ½æ²’æœ‰ã€‚</div>`;
        if (p === 39) return `<p>æ¥ä¸‹ä¾†ï¼Œæˆ‘å°‡åˆ†äº«é€éé€™äº›å¹´çš„ç ”ç©¶ï¼Œç„¡æ•¸çš„å¤œæ™šï¼Œæ€ç´¢å‡ºçš„ACAANç†è«–æ¨¡å‹ã€‚é€™æ¶‰åŠåˆ°å°è§€çœ¾é¸æ“‡è·¯å¾‘çš„å¾¹åº•å°é–ã€‚</p>`;
        if (p === 40) return `<h2 style="text-align:center; margin-top:80px; color:var(--header-text); letter-spacing:3px;">END OF SECTION</h2><hr style="border:0; border-top:1px solid #eee; margin: 40px auto; width: 40%;"><p style="text-align:center; font-size:14px; opacity: 0.6;">ç¬¬å››ç« ï¼šå±¬æ–¼æˆ‘çš„ ACAAN æœ€çµ‚å¯¦å‹™</p>`;
        const dict = { T: ["æ½›æ„è­˜çµæ§‹","é æœŸç®¡ç†","è¡Œç‚ºåˆ†æ","å£“åŠ›æ‰‹æ®µ","çµ•å°ä½ç§»","ç’°å¢ƒå†·è®€"], S: ["å¿ƒéˆé­”è¡“çš„æ ¸å¿ƒåœ¨æ–¼å°äººé¡èªçŸ¥çš„é‡æ–°æ¶æ§‹ã€‚","æ‰€è¬‚çš„è‡ªç”±æ„å¿—ï¼Œåœ¨ç‰¹å®šç’°å¢ƒä¸‹æ¥µæ˜“è¢«æ“æ§ã€‚","åˆ©ç”¨ç’°å¢ƒä¸­çš„å™ªéŸ³ä¾†é®è”½é—œéµå‹•ä½œã€‚"] };
        return `<h2>${dict.T[p%6]}</h2><p class="drop-cap">${dict.S[p%3]}</p><p>æœ¬ç¯€è¨è«–çš„æ˜¯å¦‚ä½•åˆ©ç”¨ç’°å¢ƒå…‰ç·šèˆ‡è²éŸ³é »ç‡ï¼Œåœ¨ä¸ç¶“æ„é–“å¼•å°å°æ–¹çš„æ•¸å­—é¸æ“‡ã€‚é€™éœ€è¦é•·æœŸçš„ç·´ç¿’èˆ‡å°äººé¡å¾®è¡¨æƒ…çš„ç²¾ç¢ºæ•æ‰...</p><div class="master-note">Archive Ref: #MN-${p*7}</div>`;
    }

    function render() {
        var content = document.getElementById("articleContent"), pgText = document.getElementById("cur-p"), dot = document.getElementById("dot"), artDiv = document.getElementById("article");
        artDiv.scrollTop = 0; content.classList.remove("fade-page"); void content.offsetWidth; content.classList.add("fade-page");
        dot.style.left = currentPage + "%"; pgText.innerText = currentPage; content.innerHTML = getDynamicContent(currentPage);
    }
    function next() { if(currentPage < 100) { currentPage++; render(); } }
    function prev() { if(currentPage > 1) { currentPage--; render(); } }
    document.addEventListener("contextmenu", e => e.preventDefault());
</script>
</body>
</html>

