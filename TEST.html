<!DOCTYPE html>
<html lang="zh-TW">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
 <meta name="apple-mobile-web-app-capable" content="yes">
 <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
 <meta name="apple-mobile-web-app-title" content="é›»å­æ¨¹">
 <meta id="theme-color-meta" name="theme-color" content="#ffffff">
 <title>é›»å­æ¨¹APP</title>
 <link rel="apple-touch-icon" href="Tree.png">
 <link rel="icon" href="Tree.png" type="image/png">
 <style>
    :root {
        --paper-bg: #fffdfb; --text-color: #787878; --header-text: #bbbbbb; --accent-brown: #8b572a; --shelf-bg: #ffffff; --ui-blue: #007aff;
    }
    * { -webkit-tap-highlight-color: transparent !important; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; box-sizing: border-box; }
    
    html { background-color: #fff; height: 100%; } 
    body { margin: 0; padding: 0; height: 100%; width: 100%; background-color: #fff; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", Arial, sans-serif; overflow: hidden; transition: background-color 0.4s ease; }

    /* --- å•Ÿå‹•ç•«é¢ --- */
    #splash-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100dvh; background: #fff; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s; }

    /* --- ä¸»è¦å®¹å™¨ --- */
    .view-container { width: 100%; max-width: 500px; height: calc(100dvh - 65px - env(safe-area-inset-bottom)); margin: 0 auto; display: none; flex-direction: column; overflow-y: auto; background: var(--shelf-bg); }
    .active-view { display: flex; }

    /* --- 1. æ›¸æ«ƒè¦–åœ– --- */
    .lib-header { height: calc(65px + env(safe-area-inset-top)); display: flex; align-items: flex-end; padding: 0 20px 15px; font-size: 26px; font-weight: 800; border-bottom: 1px solid #f2f2f2; background: #fff; }
    .header-logo { width: 32px; height: 32px; border-radius: 7px; margin-right: 12px; margin-bottom: 2px; }
    .lib-content { padding: 20px; }
    .book-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px 20px; }
    .book-card { display: flex; flex-direction: column; }
    .book-cover { width: 100%; aspect-ratio: 2/3; border-radius: 6px; box-shadow: 0 6px 15px rgba(0,0,0,0.12); display: flex; align-items: center; justify-content: center; text-align: center; padding: 12px; font-size: 14px; font-weight: bold; color: white; position: relative; overflow: hidden; }
    .book-cover::after { content: ''; position: absolute; top:0; left:0; width: 6%; height:100%; background: linear-gradient(to right, rgba(255,255,255,0.3), rgba(0,0,0,0.05)); }
    .book-info { margin-top: 10px; font-size: 13px; color: #333; font-weight: 600; height: 36px; overflow: hidden; }

    /* --- åº•éƒ¨å°è¦½ --- */
    #main-nav { height: calc(65px + env(safe-area-inset-bottom)); border-top: 1px solid #eee; display: flex; justify-content: space-around; align-items: center; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); position: fixed; bottom: 0; width: 100%; max-width: 500px; z-index: 1000; padding-bottom: env(safe-area-inset-bottom); }
    .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 10px; color: #999; width: 33%; }
    .nav-item.active { color: var(--ui-blue); }

    /* --- å½ˆçª—ç³»çµ± --- */
    #info-view, #ebook-app { display: none; background: white; width: 100%; max-width: 500px; height: 100dvh; position: fixed; top: 0; left: 50%; transform: translateX(-50%); z-index: 2000; overflow-y: auto; flex-direction: column; align-items: center; }
    #info-view { padding-top: calc(40px + env(safe-area-inset-top)); }
    .info-cover-box { width: 160px; height: 240px; border-radius: 4px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; text-align: center; padding: 15px; font-weight: bold; color: white; }
    .read-btn { width: 85%; background: var(--ui-blue); color: white; padding: 16px; border-radius: 10px; font-weight: bold; margin-top: auto; margin-bottom: 40px; text-align: center; font-size: 16px; }

    /* ============ iOS 26 é–å±èˆ‡è§£é–æµç¨‹ ============ */
    #magic-setup { 
        display: none; width: 100%; max-width: 500px; height: 100dvh; position: fixed; top: 0; left: 50%; transform: translateX(-50%); z-index: 4000; 
        background: url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=2564&auto=format&fit=crop') center/cover;
        overflow: hidden;
    }
    
    /* ç»ç’ƒæ„Ÿè¦†è“‹å±¤ */
    .magic-overlay { position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.2); backdrop-filter: blur(0px); transition: backdrop-filter 0.5s; }
    .setup-active .magic-overlay { backdrop-filter: blur(25px); background: rgba(0,0,0,0.4); }

    /* é–å®šç•«é¢å…§å®¹ (ç¬¬ä¸€å±¤) */
    #lock-screen-content {
        position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center;
        transition: transform 0.6s cubic-bezier(0.19, 1, 0.22, 1), opacity 0.4s;
        z-index: 10;
    }
    .ios-time { margin-top: calc(80px + env(safe-area-inset-top)); font-size: 88px; font-weight: 200; color: white; letter-spacing: -2px; }
    .ios-date { font-size: 20px; font-weight: 500; color: white; margin-top: -10px; }
    
    .swipe-hint { position: absolute; bottom: calc(20px + env(safe-area-inset-bottom)); display: flex; flex-direction: column; align-items: center; color: white; animation: bounce 2s infinite; }
    .swipe-bar { width: 140px; height: 5px; background: white; border-radius: 10px; margin-top: 15px; opacity: 0.8; }
    @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} 60% {transform: translateY(-5px);} }

    /* å¯†ç¢¼è¼¸å…¥å…§å®¹ (ç¬¬äºŒå±¤) */
    #passcode-screen-content {
        position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center;
        transform: translateY(100%); transition: transform 0.6s cubic-bezier(0.19, 1, 0.22, 1);
        z-index: 20; padding-top: calc(60px + env(safe-area-inset-top));
    }
    .setup-active #lock-screen-content { transform: translateY(-100%); opacity: 0; }
    .setup-active #passcode-screen-content { transform: translateY(0); }

    .passcode-header { font-size: 18px; color: #fff; font-weight: 500; margin-bottom: 30px; }
    .passcode-dots { display: flex; gap: 20px; margin-bottom: 50px; }
    .dot { width: 13px; height: 13px; border: 1.5px solid #fff; border-radius: 50%; transition: background 0.2s; }
    .dot.filled { background: #fff; }

    .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px 25px; width: 290px; }
    .key { 
        width: 78px; height: 78px; border-radius: 50%; background: rgba(255,255,255,0.15); 
        color: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; 
        transition: background 0.1s; cursor: pointer;
    }
    .key:active { background: rgba(255,255,255,0.4); }
    .key-num { font-size: 32px; font-weight: 400; }
    .key-letters { font-size: 10px; font-weight: 700; letter-spacing: 1px; }
    
    .keypad-footer { margin-top: auto; margin-bottom: calc(50px + env(safe-area-inset-bottom)); width: 80%; display: flex; justify-content: space-between; color: white; font-size: 16px; }

    /* éœ‡å‹•éŒ¯èª¤å‹•ç•« */
    @keyframes shake { 0%, 100% { transform: translateX(0); } 20%, 60% { transform: translateX(-15px); } 40%, 80% { transform: translateX(15px); } }
    .shake-err { animation: shake 0.4s ease-in-out; }

    /* é–±è®€å™¨æ¨£å¼ä¿æŒä¸è®Š */
    #ebook-app { background-color: var(--paper-bg); padding: 0; }
    #app-header { flex-shrink: 0; height: calc(55px + env(safe-area-inset-top)); display: flex; justify-content: space-between; align-items: center; padding: env(safe-area-inset-top) 15px 0; border-bottom: 1px solid rgba(0,0,0,0.04); background: var(--paper-bg); width: 100%; }
    #article { flex: 1; overflow-y: auto; padding: 30px 25px 60px 35px; text-align: justify; line-height: 2.3; font-size: 18px; color: var(--text-color); }
    #article p { margin-bottom: 35px; text-indent: 2em; font-family: "Noto Serif TC", serif; }
    #app-footer { flex-shrink: 0; background: var(--paper-bg); border-top: 1px solid rgba(0,0,0,0.04); padding: 15px 30px calc(15px + env(safe-area-inset-bottom)) 30px; width: 100%; }
 </style>
</head>
<body>

<div id="splash-screen">
    <img src="Tree.png" style="width: 100px; height: 100px; border-radius: 22px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
    <h2 style="margin-top: 25px; color: #333; letter-spacing: 6px; font-weight: 800;">é›»å­æ¨¹</h2>
</div>

<div id="library-view" class="view-container active-view">
    <div class="lib-header"><img src="Tree.png" class="header-logo">æˆ‘çš„æ›¸æ«ƒ</div>
    <div class="lib-content"><div class="book-grid" id="mainGrid"></div></div>
</div>

<div id="main-nav">
    <div class="nav-item active" id="nav-lib" onclick="switchTab('library')"><span>ğŸ“š</span><span>æ›¸æ«ƒ</span></div>
    <div class="nav-item"><span>ğŸ›’</span><span>å•†åº—</span></div>
    <div class="nav-item" id="nav-set" onclick="switchTab('settings')"><span>âš™ï¸</span><span>è¨­å®š</span></div>
</div>

<div id="settings-view" class="view-container">
    <div style="padding:calc(40px + env(safe-area-inset-top)) 20px 20px; font-size:24px; font-weight:800">è¨­å®š</div>
    <div class="settings-item" style="padding:20px; border-bottom:1px solid #eee;"><span>å€‹äººå¸³æˆ¶</span><span style="color:#999">é­”è¡“å¸«æ£®æ£® â€º</span></div>
    <div class="settings-item" style="padding:20px; color:red;" onclick="fullReset()">æ¸…é™¤å¿«å–è¨˜æ†¶ (é‡ç½®)</div>
</div>

<div id="info-view">
    <div style="align-self:flex-start; color:var(--ui-blue); font-size: 17px; padding: 10px 25px;" onclick="closeInfo()">â€¹ æ›¸æ«ƒ</div>
    <div id="info-cover-target" class="info-cover-box"></div>
    <h2 id="info-title" style="margin-top:25px; font-size:22px;"></h2>
    <p id="info-author" style="color:#888; font-size:14px;"></p>
    <p id="info-desc" style="color:#666; font-size:14px; margin-top:20px; padding:20px 25px; border-top:1px solid #eee; line-height:1.6;"></p>
    <div class="read-btn" onclick="checkMagicFlow()">ç¹¼çºŒé–±è®€</div>
</div>

<div id="magic-setup">
    <div class="magic-overlay"></div>
    
    <div id="lock-screen-content">
        <div class="ios-time" id="ios-clock">09:41</div>
        <div class="ios-date">12æœˆ25æ—¥ æ˜ŸæœŸå››</div>
        <div class="swipe-hint">
            <span style="font-size:13px; font-weight:600; letter-spacing:1px; opacity:0.8;">å‘ä¸Šè¼•æƒä»¥è§£é–</span>
            <div class="swipe-bar"></div>
        </div>
    </div>

    <div id="passcode-screen-content">
        <div class="passcode-header">è¼¸å…¥å¯†ç¢¼</div>
        <div class="passcode-dots" id="dotsContainer">
            <div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>
        <div class="keypad">
            <div class="key" onclick="press('1')"><span class="key-num">1</span><span class="key-letters">&nbsp;</span></div>
            <div class="key" onclick="press('2')"><span class="key-num">2</span><span class="key-letters">ABC</span></div>
            <div class="key" onclick="press('3')"><span class="key-num">3</span><span class="key-letters">DEF</span></div>
            <div class="key" onclick="press('4')"><span class="key-num">4</span><span class="key-letters">GHI</span></div>
            <div class="key" onclick="press('5')"><span class="key-num">5</span><span class="key-letters">JKL</span></div>
            <div class="key" onclick="press('6')"><span class="key-num">6</span><span class="key-letters">MNO</span></div>
            <div class="key" onclick="press('7')"><span class="key-num">7</span><span class="key-letters">PQRS</span></div>
            <div class="key" onclick="press('8')"><span class="key-num">8</span><span class="key-letters">TUV</span></div>
            <div class="key" onclick="press('9')"><span class="key-num">9</span><span class="key-letters">WXYZ</span></div>
            <div style="grid-column:2" class="key" onclick="press('0')"><span class="key-num">0</span></div>
        </div>
        <div class="keypad-footer">
            <span>ç·Šæ€¥æƒ…æ³</span>
            <span onclick="closeSetup()">å–æ¶ˆ</span>
        </div>
    </div>
</div>

<div id="ebook-app">
    <div id="app-header">
        <span onclick="exitReader()" style="font-size:32px; color:var(--ui-blue);">â€¹</span>
        <span id="reader-book-title" style="font-size:12px; font-weight:bold; color:#aaa;"></span>
        <span style="font-size:18px; color:var(--ui-blue);">á´€A</span>
    </div>
    <div id="article"><div id="articleContent"></div></div>
    <div id="app-footer">
        <div class="footer-info" style="font-size:12px; color:#999; text-align:center;">ç¬¬ <span id="cur-p"></span> é  / å…± 100 é </div>
    </div>
    <div style="position:absolute; top:70px; bottom:70px; left:0; width:30%;" onclick="prev()"></div>
    <div style="position:absolute; top:70px; bottom:70px; right:0; width:30%;" onclick="next()"></div>
</div>

<script>
    const bookData = [
        { id: 1, t: "æ€è€ƒï¼Œå¿«èˆ‡æ…¢", a: "Daniel Kahneman", d: "é—œæ–¼èªçŸ¥åå·®çš„æ¬Šå¨è‘—ä½œã€‚", p: "æœªè®€", bg: "linear-gradient(45deg, #2c3e50, #000)" },
        { id: 3, t: "THE MAGIC SENTINEL", a: "David Berglas", d: "æœ¬ç« è©³ç´°è¨˜éŒ„äº†å¤§è¡›Â·å·´æ ¼æ‹‰æ–¯çš„å³èˆˆå¥‡è¹Ÿå¯¦éŒ„ã€‚æ·±å…¥æ¢è¨ ACAAN çš„æœ€çµ‚å¿ƒç†æ¶æ§‹ã€‚", p: "36% å·²è®€", isM: true, bg: "linear-gradient(to bottom, #3d2b1f, #1a110a)", color: "#e5c100" },
        { id: 4, t: "FBI è®€å¿ƒè¡“", a: "Joe Navarro", d: "å‰æƒ…å ±å“¡è¦ªæˆç ´è§£èº«é«”èªè¨€çš„æŠ€è¡“ã€‚", p: "å·²å®Œè®€", bg: "linear-gradient(to right, #434343, #000)" }
    ];

    let stack = [{suit:"æ¢…èŠ±",number:"4"},{suit:"ç´…å¿ƒ",number:"2"},{suit:"æ–¹å¡Š",number:"7"},{suit:"æ¢…èŠ±",number:"3"},{suit:"ç´…å¿ƒ",number:"4"},{suit:"æ–¹å¡Š",number:"6"},{suit:"é»‘æ¡ƒ",number:"A"},{suit:"ç´…å¿ƒ",number:"5"},{suit:"é»‘æ¡ƒ",number:"9"},{suit:"é»‘æ¡ƒ",number:"2"},{suit:"ç´…å¿ƒ",number:"Q"},{suit:"æ–¹å¡Š",number:"3"},{suit:"æ¢…èŠ±",number:"Q"},{suit:"ç´…å¿ƒ",number:"8"},{suit:"é»‘æ¡ƒ",number:"6"},{suit:"é»‘æ¡ƒ",number:"5"},{suit:"ç´…å¿ƒ",number:"9"},{suit:"æ¢…èŠ±",number:"K"},{suit:"æ–¹å¡Š",number:"2"},{suit:"ç´…å¿ƒ",number:"J"},{suit:"é»‘æ¡ƒ",number:"3"},{suit:"é»‘æ¡ƒ",number:"8"},{suit:"ç´…å¿ƒ",number:"6"},{suit:"æ¢…èŠ±",number:"10"},{suit:"æ–¹å¡Š",number:"5"},{suit:"æ–¹å¡Š",number:"K"},{suit:"æ¢…èŠ±",number:"2"},{suit:"ç´…å¿ƒ",number:"3"},{suit:"æ–¹å¡Š",number:"8"},{suit:"æ¢…èŠ±",number:"5"},{suit:"é»‘æ¡ƒ",number:"K"},{suit:"æ–¹å¡Š",number:"J"},{suit:"æ¢…èŠ±",number:"8"},{suit:"é»‘æ¡ƒ",number:"10"},{suit:"ç´…å¿ƒ",number:"K"},{suit:"æ¢…èŠ±",number:"J"},{suit:"é»‘æ¡ƒ",number:"7"},{suit:"ç´…å¿ƒ",number:"10"},{suit:"æ–¹å¡Š",number:"A"},{suit:"é»‘æ¡ƒ",number:"4"},{suit:"ç´…å¿ƒ",number:"7"},{suit:"æ–¹å¡Š",number:"4"},{suit:"æ¢…èŠ±",number:"A"},{suit:"æ¢…èŠ±",number:"9"},{suit:"é»‘æ¡ƒ",number:"J"},{suit:"æ–¹å¡Š",number:"Q"},{suit:"æ¢…èŠ±",number:"7"},{suit:"é»‘æ¡ƒ",number:"Q"},{suit:"æ–¹å¡Š",number:"10"},{suit:"æ¢…èŠ±",number:"6"},{suit:"ç´…å¿ƒ",number:"A"},{suit:"æ–¹å¡Š",number:"9"}];
    let allDecks = {}; for (let i = 0; i < 13; i++) { allDecks[String.fromCharCode(65 + i)] = stack.slice(i * 4).concat(stack.slice(0, i * 4)); }
    let resultAction = "", currentPage = 37, isCalculated = false, currentActiveBook = null, passcode = "";

    window.onload = function() {
        initShelf();
        updateClock();
        setInterval(updateClock, 1000);
        initSwipeHandler();
        setTimeout(() => { document.getElementById('splash-screen').style.opacity = '0'; setTimeout(()=>document.getElementById('splash-screen').style.display='none', 500); }, 1200);
    };

    function updateClock() {
        const now = new Date();
        const h = String(now.getHours()).padStart(2, '0');
        const m = String(now.getMinutes()).padStart(2, '0');
        document.getElementById('ios-clock').innerText = `${h}:${m}`;
    }

    function initShelf() {
        const grid = document.getElementById("mainGrid"); grid.innerHTML = "";
        bookData.forEach(b => {
            const card = document.createElement("div"); card.className = "book-card"; card.onclick = () => showInfo(b);
            card.innerHTML = `<div class="book-cover" style="background:${b.bg}; color:${b.color||'#fff'}">${b.t}</div><div class="book-info">${b.t}</div><div style="font-size:11px; color:#999;" ${b.isM?'id="magic-prog"':''}>ğŸ“– ${b.p}</div>`;
            grid.appendChild(card);
        });
    }

    function switchTab(tab) {
        document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active-view'));
        document.getElementById(tab + '-view').classList.add('active-view');
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        if(tab==='library') document.getElementById('nav-lib').classList.add('active');
        if(tab==='settings') document.getElementById('nav-set').classList.add('active');
    }

    function showInfo(b) {
        currentActiveBook = b;
        document.getElementById("info-title").innerText = b.t;
        document.getElementById("info-author").innerText = b.a;
        document.getElementById("info-desc").innerText = b.d;
        const target = document.getElementById("info-cover-target");
        target.style.background = b.bg; target.style.color = b.color || '#fff'; target.innerText = b.t;
        document.getElementById("info-view").style.display = "flex";
    }

    function closeInfo() { document.getElementById("info-view").style.display = "none"; }

    function openSetup() {
        document.getElementById("info-view").style.display = "none";
        document.getElementById("main-nav").style.display = "none";
        document.getElementById("magic-setup").style.display = "block";
        document.getElementById("magic-setup").classList.remove('setup-active'); // å›åˆ°æ™‚é˜å±¤
        clearPass();
    }

    function closeSetup() {
        document.getElementById("magic-setup").style.display = "none";
        document.getElementById("main-nav").style.display = "flex";
        document.getElementById("info-view").style.display = "flex";
    }

    // æ»‘å‹•è§£é–é‚è¼¯
    function initSwipeHandler() {
        let startY = 0;
        const setupContainer = document.getElementById('magic-setup');
        
        setupContainer.addEventListener('touchstart', (e) => { startY = e.touches[0].clientY; });
        setupContainer.addEventListener('touchend', (e) => {
            let endY = e.changedTouches[0].clientY;
            if (startY - endY > 50 && !setupContainer.classList.contains('setup-active')) {
                setupContainer.classList.add('setup-active'); // å‘ä¸Šæ»‘å‹•ï¼Œé€²å…¥å¯†ç¢¼å±¤
            }
        });
    }

    function checkMagicFlow() {
        if(currentActiveBook.isM && isCalculated) { document.getElementById("info-view").style.display="none"; openReader(); }
        else if(currentActiveBook.isM) { openSetup(); }
        else { openReader(); }
    }

    function openReader() {
        document.getElementById("main-nav").style.display = "none";
        document.getElementById("reader-book-title").innerText = currentActiveBook.t;
        document.getElementById("ebook-app").style.display = "flex";
        render();
    }

    function exitReader() {
        document.getElementById("ebook-app").style.display = "none";
        document.getElementById("main-nav").style.display = "flex";
        if(currentActiveBook.isM) document.getElementById("magic-prog").innerText = "ğŸ“– " + currentPage + "% å·²è®€";
    }

    function press(n) {
        if (passcode.length < 6) {
            passcode += n;
            updateDots();
            if (passcode.length === 6) setTimeout(calculate, 200);
        }
    }
    function updateDots() {
        const dots = document.querySelectorAll('.dot');
        dots.forEach((d, i) => { if (i < passcode.length) d.classList.add('filled'); else d.classList.remove('filled'); });
    }
    function clearPass() { passcode = ""; updateDots(); }

    function calculate() {
        const dotsBox = document.getElementById("dotsContainer");
        const suitMap = {"1":"é»‘æ¡ƒ", "2":"ç´…å¿ƒ", "3":"æ–¹å¡Š", "4":"æ¢…èŠ±"};
        const suit = suitMap[passcode[0]];
        const rankMap = ["","A","2","3","4","5","6","7","8","9","10","J","Q","K"];
        const rank = rankMap[parseInt(passcode.substring(1,3))];
        const nv = parseInt(passcode.substring(3,5));
        
        let found = false;
        if (suit && rank && !isNaN(nv)) {
            for (let k in allDecks) {
                let deck = allDecks[k], pos = -1;
                for(let i=0; i<deck.length; i++) if(deck[i].suit === suit && deck[i].number === rank) { pos = i + 1; break; }
                if (pos + 3 === nv) { setRes(k, "èƒŒé¢å‘ä¸Šä¸€å¼µå¼µå¾€ä¸‹ç™¼"); found = true; break; }
                if (pos + 2 === nv) { setRes(k, "æ‹¿æ‰å»£å‘Šç‰Œå¾Œï¼ŒèƒŒé¢å‘ä¸Šä¸€å¼µå¼µå¾€ä¸‹ç™¼"); found = true; break; }
                if (pos + 1 === nv) { setRes(k, "æ‹¿æ‰é¬¼ç‰Œå¾Œï¼ŒèƒŒé¢å‘ä¸Šä¸€å¼µå¼µå¾€ä¸‹ç™¼"); found = true; break; }
                if (pos === nv) { setRes(k, "æ‹¿æ‰é¬¼ç‰Œå’Œå»£å‘Šç‰Œå¾Œï¼ŒèƒŒé¢å‘ä¸Šä¸€å¼µå¼µå¾€ä¸‹ç™¼"); found = true; break; }
            }
        }

        if(!found) {
            dotsBox.classList.add('shake-err');
            setTimeout(() => { dotsBox.classList.remove('shake-err'); clearPass(); }, 450);
            return;
        }

        isCalculated = true;
        document.getElementById("magic-setup").style.display = "none";
        openReader();
    }

    function setRes(k, act) { 
        const loc = {"A":"çª—å°ä¸Š","B":"æ›¸æ«ƒä¸­é–“","C":"é…’æ«ƒè£¡","D":"è¡£æ«ƒè£¡","E":"æ‰‹æåŒ…å…§","F":"å£è¢‹å…§","G":"æ¤…å­åº•ä¸‹","H":"æ¡Œä¸Šçš„ç›’å­å…§","I":"æ‹›è²¡è²“å¾Œé¢","J":"æŠ½å±œ","K":"å´é‚ŠæŠ½å±œ","L":"é›»è¦–ä¸‹æ–¹","M":"æ«ƒå­"};
        resultAction = `å¾${loc[k]||"èº«å¾Œ"}æ‹¿å‡ºä¸€å‰¯ç‰Œï¼Œå¤§è¡›è«‹æˆ‘å°‡ç‰Œå–å‡ºï¼Œ${act}ï¼Œ`; 
    }

    function getDynamicContent(p) {
        if (currentActiveBook.isM && p === 37) {
            return `<p class="drop-cap">æ•…äº‹ç™¼ç”Ÿåœ¨ 1976 å¹´ã€‚ç•¶æ™‚å¤§è¡›é‚€è«‹æˆ‘å»ä»–å®¶ä½œå®¢ï¼ŒèŠçš„æ­£æ„‰å¿«æ™‚ï¼Œå¤§è¡›çªç„¶å•æˆ‘ï¼šã€Œéš¨ä¾¿èªªä¸€å¼µç‰Œï¼Œå’Œä¸€å€‹ 1 åˆ° 52 ä¹‹é–“çš„æ•¸å­—ã€‚ã€</p><p>æˆ‘ä¸å‡æ€ç´¢åœ°å›ç­”ï¼šã€Œæ–¹å¡Š 5ï¼Œ32ã€ã€‚</p><p>å¤§è¡›ç·©ç·©èµ·èº«ï¼Œ${resultAction} ç•¶æ•¸åˆ°ç¬¬ 32 å¼µæ™‚ï¼Œç©ºæ°£ä»¿ä½›å‡å›ºäº†...</p><p>é‚£å¼µç‰Œæ­£æ˜¯ã€Œæ–¹å¡Š 5ã€ï¼æˆ‘æ°¸é å¿˜ä¸äº†é‚£ä¸€å¤©ã€‚</p>`;
        }
        return `<p class="drop-cap">å¿ƒéˆé­”è¡“çš„æ ¸å¿ƒåœ¨æ–¼å°äººé¡èªçŸ¥çš„é‡æ–°æ¶æ§‹ã€‚æ‰€è¬‚çš„è‡ªç”±æ„å¿—ï¼Œåœ¨ç‰¹å®šç’°å¢ƒä¸‹æ¥µæ˜“è¢«æ“æ§ã€‚æˆ‘å€‘æ‰€è¦‹ã€æ‰€è½ã€æ‰€æƒ³ï¼Œå¾€å¾€éƒ½ç¶“éäº†æ½›æ„è­˜çš„éæ¿¾ã€‚</p><p>åœ¨é€™ä¸€ç« ï¼Œæˆ‘å€‘å°‡æ·±å…¥æ¢è¨å¦‚ä½•å¼•å°è§€çœ¾é€²å…¥æˆ‘å€‘é è¨­çš„æ€è€ƒæ¡†æ¶ä¸­ã€‚</p>`;
    }

    function render() {
        document.getElementById("article").scrollTop = 0;
        document.getElementById("articleContent").innerHTML = getDynamicContent(currentPage);
        document.getElementById("cur-p").innerText = currentPage;
    }
    function next() { if(currentPage < 100) { currentPage++; render(); } }
    function prev() { if(currentPage > 1) { currentPage--; render(); } }
    function fullReset() { isCalculated = false; currentPage = 37; alert("ç³»çµ±å·²é‡ç½®"); }
    document.addEventListener("contextmenu", e => e.preventDefault());
</script>
</body>
</html>
