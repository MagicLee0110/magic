<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="Notification.png">
    <link rel="icon" href="Notification.png" type="image/png">
    <title>iOS Magic Pro - Full Restore</title>
    <style>
        :root {
            --ios-font: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", "Helvetica Neue", Arial, sans-serif;
            --handwriting-font: "Cursive", "Bradley Hand", "Marker Felt", "Chalkboard SE", sans-serif;
            --main-gradient: linear-gradient(180deg, #000000 0%, #1a152e 40%, #000000 100%);
            --accent-color: #d4a017;
        }

        html, body {
            margin: 0; padding: 0; width: 100%; height: 100%;
            font-family: var(--ios-font);
            overflow: hidden;
            background-color: #000;
            touch-action: none; 
        }

        /* --- é€šçŸ¥ä¸­å¿ƒ --- */
        #notification-center {
            width: 100%; height: 100%;
            background: var(--main-gradient);
            background-attachment: fixed;
            position: relative;
            color: white;
            display: flex;
            flex-direction: column;
        }

        .top-content { flex: 0 0 auto; z-index: 10; }

        .clock-container {
            text-align: center;
            padding-top: calc(env(safe-area-inset-top) + 60px);
            user-select: none;
            -webkit-user-select: none;
        }
        .time-text { font-size: 95px; font-weight: 200; margin: 0; letter-spacing: -2px; }
        .date-text { font-size: 19px; opacity: 0.9; }

        .notification-header { padding: 40px 25px 15px; font-size: 28px; font-weight: 600; }

        .notification-list { padding: 0 15px; }
        .notif-card {
            background: rgba(40, 40, 40, 0.4);
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border-radius: 24px; padding: 15px; margin-bottom: 12px;
            display: flex; flex-direction: column;
        }
        .notif-top { display: flex; gap: 12px; }
        .notif-content { flex: 1; }
        .notif-title-row { display: flex; justify-content: space-between; font-size: 15px; font-weight: 600; }
        .notif-body { font-size: 14px; line-height: 1.4; opacity: 0.9; }

        /* --- ä¹å®®æ ¼ --- */
        .magic-area {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            z-index: 999;
            margin-bottom: 40px;
        }
        .magic-btn { width: 100%; height: 100%; background: transparent; }

        /* --- å‚™å¿˜éŒ„ --- */
        #memo-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; color: #fff;
            display: none; flex-direction: column; z-index: 2000;
        }
        .memo-header { padding: calc(env(safe-area-inset-top) + 10px) 20px 10px; display: flex; justify-content: space-between; align-items: center; color: var(--accent-color); font-size: 17px; z-index: 2010; }
        .memo-content-area { flex: 1; position: relative; width: 100%; display: flex; justify-content: center; align-items: center; }
        #handwritingNumber { font-family: var(--handwriting-font); font-size: 220px; font-weight: 500; color: rgba(255, 255, 255, 0.95); z-index: 2001; user-select: none; }
        #sketchCanvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2005; }

        /* --- å¾Œå°ç³»çµ± --- */
        #backstage-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #1c1c1e; color: white;
            display: none; flex-direction: column; z-index: 3000;
            padding: calc(env(safe-area-inset-top) + 20px) 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }
        .profile-list { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 15px; }
        .profile-tab { padding: 8px 16px; background: #333; border-radius: 20px; font-size: 14px; white-space: nowrap; border: 2px solid transparent; }
        .profile-tab.active { background: var(--accent-color); color: black; border-color: #fff; }
        .config-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .profile-name-input { flex: 1; background: #2c2c2e; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px; font-size: 16px; }
        .grid-inputs { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .grid-inputs input { background: #2c2c2e; border: 1px solid #444; color: white; padding: 15px 5px; border-radius: 8px; text-align: center; font-size: 18px; }
        .action-btns { display: flex; gap: 10px; padding-bottom: 40px; }
        .btn { flex: 1; border: none; padding: 15px; border-radius: 12px; font-size: 16px; font-weight: bold; }
        .save-btn { background: var(--accent-color); color: black; }
        .add-btn { background: #32d74b; color: black; }
        .del-btn { background: #ff453a; color: white; flex: 0 0 60px; border-radius: 12px; border:none; }

        .home-bar { position: fixed; bottom: 8px; left: 50%; transform: translateX(-50%); width: 140px; height: 5px; background: rgba(255, 255, 255, 0.3); border-radius: 10px; z-index: 4000; }
    </style>
</head>
<body>

    <div id="notification-center">
        <div class="top-content">
            <div class="clock-container" id="clockZone" onclick="openMemo(null)">
                <div class="date-text" id="dateDisplay">1æœˆ3æ—¥ é€±å…­</div>
                <h1 class="time-text" id="timeDisplay">15:02</h1>
            </div>
            
            <div class="notification-header">é€šçŸ¥ä¸­å¿ƒ</div>
            
            <div class="notification-list">
                <div class="notif-card">
                    <div class="notif-top">
                        <div style="width:38px; height:38px; background:#ff4500; border-radius:8px; display:flex; align-items:center; justify-content:center; font-weight:bold;">S</div>
                        <div class="notif-content">
                            <div class="notif-title-row"><span>æ‚¨é—œæ³¨çš„è³£å®¶é–‹å§‹ç›´æ’­äº†ï¼</span><span style="opacity:0.6; font-size:13px;">1å°æ™‚å‰</span></div>
                            <div class="notif-body">è§€çœ‹ Yomigirls çš„ç›´æ’­ï¼šç¥ç¾æµ©è‚¯åŒ…ğŸ¤©...</div>
                        </div>
                    </div>
                </div>
                
                <div class="notif-card">
                    <div class="notif-top">
                        <div style="width:38px; height:38px; background:#006aa6; border-radius:8px; display:flex; align-items:center; justify-content:center; font-weight:bold;">D</div>
                        <div class="notif-content">
                            <div class="notif-title-row"><span>ä½ è¿½è¹¤çš„ã€Œç†è²¡æ¿ã€æ–°æ–‡ç« </span><span style="opacity:0.6; font-size:13px;">2å°æ™‚å‰</span></div>
                            <div class="notif-body">ã€Œå°è‚¡ç˜‹äº† æ­£äºŒä¹Ÿç˜‹äº†ã€</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="magic-area">
            <div class="magic-btn" onclick="openMemo(0)"></div>
            <div class="magic-btn" onclick="openMemo(1)"></div>
            <div class="magic-btn" onclick="openMemo(2)"></div>
            <div class="magic-btn" onclick="openMemo(3)"></div>
            <div class="magic-btn" onclick="openMemo(4)"></div>
            <div class="magic-btn" onclick="openMemo(5)"></div>
            <div class="magic-btn" onclick="openMemo(6)"></div>
            <div class="magic-btn" onclick="openMemo(7)"></div>
            <div class="magic-btn" onclick="openMemo(8)"></div>
        </div>
        <div class="home-bar"></div>
    </div>

    <div id="memo-screen">
        <div class="memo-header">
            <span onclick="closeMemo()">ï¼œ å‚™å¿˜éŒ„</span>
            <span style="font-weight:600;" onclick="closeMemo()">å®Œæˆ</span>
        </div>
        <div class="memo-content-area">
            <div id="handwritingNumber"></div>
            <canvas id="sketchCanvas"></canvas>
        </div>
        <div class="home-bar"></div>
    </div>

    <div id="backstage-screen">
        <div style="font-size:22px; font-weight:bold; margin-bottom:20px; text-align:center;">ä¹å®®æ ¼åˆ†çµ„ç®¡ç†</div>
        
        <div class="profile-list" id="profileTabs"></div>

        <div class="profile-section">
            <div class="config-row">
                <input type="text" id="profileName" class="profile-name-input" placeholder="è¨­å®šçµ„åç¨±">
                <button class="del-btn" onclick="deleteCurrentProfile()">åˆªé™¤</button>
            </div>
            
            <div class="grid-inputs" id="gridInputContainer"></div>
        </div>

        <div class="action-btns">
            <button class="btn add-btn" onclick="addNewProfile()">+ æ–°å¢åˆ†çµ„</button>
            <button class="btn save-btn" onclick="saveAllAndClose()">å„²å­˜ä¸¦é—œé–‰</button>
        </div>
    </div>

    <script>
        // --- è³‡æ–™ç®¡ç† ---
        let appData = {
            activeIdx: 0,
            profiles: [
                { name: "é è¨­æ•¸å€¼", values: ["198", "297", "396", "495", "594", "693", "792", "891", "99"] },
                { name: "ç”Ÿæ—¥è¿«ç‰Œ", values: ["10", "19", "8", "12", "25", "7", "3", "14", "21"] }
            ]
        };

        const saved = localStorage.getItem('magicProDataV2');
        if (saved) appData = JSON.parse(saved);

        // --- å¾Œå° UI æ¸²æŸ“ ---
        function renderBackstage() {
            const tabs = document.getElementById('profileTabs');
            const grid = document.getElementById('gridInputContainer');
            const current = appData.profiles[appData.activeIdx];

            tabs.innerHTML = '';
            appData.profiles.forEach((p, i) => {
                const tab = document.createElement('div');
                tab.className = `profile-tab ${i === appData.activeIdx ? 'active' : ''}`;
                tab.textContent = p.name;
                tab.onclick = () => { appData.activeIdx = i; renderBackstage(); };
                tabs.appendChild(tab);
            });

            document.getElementById('profileName').value = current.name;
            document.getElementById('profileName').oninput = (e) => {
                current.name = e.target.value;
                renderBackstage(); 
            };

            grid.innerHTML = '';
            for (let i = 0; i < 9; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.value = current.values[i] || "";
                input.oninput = (e) => { current.values[i] = e.target.value; };
                grid.appendChild(input);
            }
        }

        function addNewProfile() {
            appData.profiles.push({ name: "æ–°è¨­å®š " + (appData.profiles.length + 1), values: Array(9).fill("") });
            appData.activeIdx = appData.profiles.length - 1;
            renderBackstage();
        }

        function deleteCurrentProfile() {
            if (appData.profiles.length <= 1) return alert("è‡³å°‘éœ€ä¿ç•™ä¸€å€‹è¨­å®šçµ„");
            appData.profiles.splice(appData.activeIdx, 1);
            appData.activeIdx = 0;
            renderBackstage();
        }

        function saveAllAndClose() {
            localStorage.setItem('magicProDataV2', JSON.stringify(appData));
            document.getElementById('backstage-screen').style.display = 'none';
        }

        // --- é•·æŒ‰ & æ™‚é˜ ---
        let pressTimer;
        const clockZone = document.getElementById('clockZone');
        clockZone.addEventListener('touchstart', () => {
            pressTimer = setTimeout(() => {
                renderBackstage();
                document.getElementById('backstage-screen').style.display = 'flex';
            }, 1500);
        });
        clockZone.addEventListener('touchend', () => clearTimeout(pressTimer));

        function updateClock() {
            const now = new Date();
            document.getElementById('timeDisplay').textContent = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
            const weekDays = ["é€±æ—¥", "é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››", "é€±äº”", "é€±å…­"];
            document.getElementById('dateDisplay').textContent = `${now.getMonth() + 1}æœˆ${now.getDate()}æ—¥ ${weekDays[now.getDay()]} Â· ä¹™å·³å¹´å†¬æœˆåäº”`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        // --- ç•«å¸ƒé‚è¼¯ ---
        const canvas = document.getElementById('sketchCanvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;

        function initCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            ctx.strokeStyle = "rgba(255, 255, 255, 0.95)";
            ctx.lineWidth = 10;
            ctx.lineCap = "round";
            ctx.lineJoin = "round";
        }
        window.addEventListener('resize', initCanvas);
        initCanvas();

        function startDrawing(e) { drawing = true; draw(e); }
        function stopDrawing() { drawing = false; ctx.beginPath(); }
        function draw(e) {
            if (!drawing) return;
            const x = e.touches ? e.touches[0].clientX : e.clientX;
            const y = e.touches ? e.touches[0].clientY : e.clientY;
            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDrawing(e); });
        canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); });
        canvas.addEventListener('touchend', stopDrawing);

        // --- å‚™å¿˜éŒ„åˆ‡æ› ---
        function openMemo(index) {
            document.getElementById('notification-center').style.display = 'none';
            document.getElementById('memo-screen').style.display = 'flex';
            const numEl = document.getElementById('handwritingNumber');
            
            if (index === null) {
                numEl.style.display = 'none';
                canvas.style.display = 'block';
                ctx.clearRect(0, 0, canvas.width, canvas.height); 
            } else {
                numEl.textContent = appData.profiles[appData.activeIdx].values[index];
                numEl.style.display = 'block';
                canvas.style.display = 'none';
            }
        }

        function closeMemo() {
            document.getElementById('memo-screen').style.display = 'none';
            document.getElementById('notification-center').style.display = 'flex';
        }
    </script>
</body>
</html>
